<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SS1 Voice Auditions</title>
<style>
:root{--bg:#0b1220;--card:#020617;--border:#1f2937;--accent:#2563eb;--danger:#dc2626;--muted:#9ca3af;}
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#e5e7eb;}
header{background:#050912;border-bottom:1px solid var(--border);} 
header .wrap{max-width:1100px;margin:0 auto;padding:20px;}
.main{max-width:1100px;margin:0 auto;padding:20px 16px 140px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;}
.card .top{position:relative;}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover;background:#030712;}
.card .delete-btn{position:absolute;top:8px;right:8px;background:var(--danger);border:none;color:white;border-radius:999px;width:28px;height:28px;cursor:pointer;}
.card .body{padding:12px 14px 14px;}
.card h3{margin:0 0 6px 0;font-size:1rem;}
.card p{margin:0 0 10px 0;color:var(--muted);font-size:14px;}
.card button.apply{width:100%;}
button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:10px;cursor:pointer;}
button.secondary{background:#374151;}
button.danger{background:var(--danger);}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px;}
#modal .panel{background:var(--card);border:1px solid var(--border);border-radius:18px;max-width:680px;width:100%;padding:20px;max-height:90vh;overflow-y:auto;}
.lines{background:#030712;border:1px dashed var(--border);padding:10px;border-radius:12px;font-size:14px;}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0;}
input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#020617;color:white;margin:6px 0;}
.status{font-size:13px;color:var(--muted);} 
.rec-visual{display:flex;align-items:center;gap:10px;margin:10px 0;}
.rec-dot{width:14px;height:14px;border-radius:50%;background:#555;transition:.2s;}
.rec-dot.recording{background:var(--danger);box-shadow:0 0 10px var(--danger);}
.rec-ring{width:40px;height:40px;border:3px solid #444;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.rec-ring.recording{animation:pulse 1s infinite;}
@keyframes pulse{0%{transform:scale(1);opacity:1;}50%{transform:scale(1.15);opacity:.6;}100%{transform:scale(1);opacity:1;}}
#timer{font-variant:tabular-nums;}
#add-section{margin-top:60px;padding-top:20px;border-top:1px solid var(--border);} 
.add-row{display:grid;grid-template-columns:1fr 120px;gap:10px;align-items:center;}
.editor-bar{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;}
.editor-bar button{background:#0e1627;}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>üéôÔ∏è SS1 Animated Series ‚Äî Voice Auditions</h1>
    <p>Choose a character ‚Üí Click <strong>Apply</strong> ‚Üí Record ‚Üí Submit.</p>
  </div>
</header>

<div class="main">
  <div class="grid" id="characters"></div>

  <section id="add-section">
    <h2>Editor: Add / Manage Characters</h2>
    <div class="editor-bar">
      <button class="secondary" onclick="copyAllToClipboard()">üìã Copy All Character Data (JSON)</button>
    </div>
    <div class="add-row">
      <input id="newName" placeholder="Character name (e.g. 'Lola ‚Äî The Dreamer')" />
      <select id="newGender">
        <option value="female">Female</option>
        <option value="male">Male</option>
      </select>
    </div>
    <textarea id="newDesc" placeholder="Short description"></textarea>
    <textarea id="newLines" placeholder="Lines ‚Äî separate each with |"></textarea>
    <button onclick="addCharacterFromForm()">Add Character</button>
  </section>
</div>

<div id="modal">
  <div class="panel">
    <button class="secondary" onclick="closeModal()" style="float:right">Close ‚úñ</button>
    <h2 id="mTitle"></h2>
    <p id="mDesc"></p>
    <div class="lines"><strong>Read these lines:</strong><ol id="mLines"></ol></div>
    <div class="rec-visual">
      <div class="rec-ring" id="ring"><div class="rec-dot" id="dot"></div></div>
      <div class="status" id="mStatus">Click Start to record.</div>
      <div id="timer">00:00</div>
    </div>
    <div class="controls">
      <button onclick="startRecording()">Start Recording</button>
      <button class="secondary" onclick="stopRecording()">Stop</button>
      <button class="secondary" onclick="playRecording()">Play</button>
      <button class="danger" onclick="resetRecording()">Reset</button>
    </div>
    <input id="audName" placeholder="Your Name" />
    <input id="audPhone" placeholder="Phone Number" />
    <button onclick="submitAudition()">Submit Audition</button>
  </div>
</div>

<script>
// -------- DATA --------
let characters = [
  {id:'tunde',name:'Tunde ‚Äî The Leader',gender:'male',desc:'Confident, witty, and keeps the group together.',lines:['Guys, calm down ‚Äî we can fix this together.','If we get caught, we are FINISHED.','Trust me, I have a plan.']},
  {id:'ife',name:'Ife ‚Äî The Brain',gender:'female',desc:'Quiet but brilliant; thinks before she speaks.',lines:['Actually, that equation makes no sense.','If we study now, we won‚Äôt fail tomorrow.','I told you this would happen.']},
  {id:'bayo',name:'Bayo ‚Äî The Class Clown',gender:'male',desc:'Loud, funny, and always cracking jokes.',lines:['Oga, you dey mad?!','You people take school too serious!','Wait till you hear this one‚Ä¶']},
  {id:'amina',name:'Amina ‚Äî The Peacekeeper',gender:'female',desc:'Kind-hearted and emotionally intelligent.',lines:['Please, let‚Äôs not fight.','Everyone deserves a second chance.','We are a team, remember?']},
  {id:'chinedu',name:'Chinedu ‚Äî The Troublemaker',gender:'male',desc:'Mischievous, daring, and always pushing boundaries.',lines:['What‚Äôs the worst that could happen?','Relax, I‚Äôve done this before.','Follow me if you‚Äôre brave.']}
];

// -------- RENDER GRID --------
function render(){
  const g = document.getElementById('characters');
  g.innerHTML='';
  characters.forEach(c=>{
    const img = c.gender === 'female' ? 'female.png' : 'male.png';
    const d = document.createElement('div');
    d.className='card';
    d.innerHTML=`
      <div class='top'>
        <img src='${img}' alt='${c.gender} profile'>
        <button class='delete-btn' onclick="deleteCharacter('${c.id}')">‚úñ</button>
      </div>
      <div class='body'>
        <h3>${c.name}</h3>
        <p>${c.desc}</p>
        <button class='apply' onclick="openModal('${c.id}')">Apply üé§</button>
      </div>`;
    g.appendChild(d);
  });
}
render();

// -------- EDITOR FUNCTIONS --------
function addCharacterFromForm(){
  const name=document.getElementById('newName').value.trim();
  const desc=document.getElementById('newDesc').value.trim();
  const gender=document.getElementById('newGender').value;
  const lines=document.getElementById('newLines').value.split('|').map(l=>l.trim()).filter(Boolean);
  if(!name||!desc||lines.length<1){alert('Fill all fields (lines separated by |)');return;}
  characters.push({id:'c'+Date.now(),name,gender,desc,lines});
  render();
  document.getElementById('newName').value='';
  document.getElementById('newDesc').value='';
  document.getElementById('newLines').value='';
}

function deleteCharacter(id){
  if(!confirm('Delete this character?')) return;
  characters = characters.filter(c=>c.id!==id);
  render();
}

function copyAllToClipboard(){
  const json = JSON.stringify(characters, null, 2);
  navigator.clipboard.writeText(json).then(()=>{
    alert('All character data copied to clipboard!');
  });
}

// -------- MODAL --------
let currentChar=null;
function openModal(id){
  currentChar = characters.find(c=>c.id===id);
  document.getElementById('mTitle').textContent=currentChar.name;
  document.getElementById('mDesc').textContent=currentChar.desc;
  const ol=document.getElementById('mLines');
  ol.innerHTML=currentChar.lines.map(l=>`<li>"${l}"</li>`).join('');
  document.getElementById('mStatus').textContent='Click Start to record.';
  document.getElementById('modal').style.display='flex';
}
function closeModal(){ document.getElementById('modal').style.display='none'; }

// -------- AUDIO RECORDING --------
let stream, recorder, chunks=[], audioBlob=null, timerInterval=null, seconds=0;
const dot=document.getElementById('dot');
const ring=document.getElementById('ring');
const timer=document.getElementById('timer');

function startTimer(){
  seconds=0; timer.textContent='00:00';
  timerInterval=setInterval(()=>{
    seconds++;
    const m=String(Math.floor(seconds/60)).padStart(2,'0');
    const s=String(seconds%60).padStart(2,'0');
    timer.textContent=`${m}:${s}`;
  },1000);
}
function stopTimer(){ clearInterval(timerInterval); }

async function startRecording(){
  document.getElementById('mStatus').textContent='Requesting microphone...';
  if(!stream){ stream = await navigator.mediaDevices.getUserMedia({audio:true}); }
  chunks=[];
  let mime = 'audio/mpeg';
  if(!('MediaRecorder' in window) || !MediaRecorder.isTypeSupported(mime)){
    mime = 'audio/webm';
  }
  recorder = new MediaRecorder(stream,{mimeType:mime});
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = ()=>{
    audioBlob = new Blob(chunks,{type: recorder.mimeType});
    document.getElementById('mStatus').textContent='Recorded. You can Play or Submit.';
    dot.classList.remove('recording'); ring.classList.remove('recording'); stopTimer();
  };
  recorder.start();
  dot.classList.add('recording'); ring.classList.add('recording'); startTimer();
  document.getElementById('mStatus').textContent='Recording... speak now.';
}
function stopRecording(){ if(recorder && recorder.state!=='inactive') recorder.stop(); }
function playRecording(){ if(!audioBlob){alert('No recording yet');return;} new Audio(URL.createObjectURL(audioBlob)).play(); }
function resetRecording(){ audioBlob=null; chunks=[]; document.getElementById('mStatus').textContent='Reset. Click Start again.'; timer.textContent='00:00'; }

// -------- SUBMIT (to Apps Script) --------
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxhHKSKq7EDeo3mmFIBVyawjkFMxGTe5IpG9dO12cWO3nRqpjOFkNoB6idtVu-MHVKlUg/exec';

async function submitAudition(){
  const name=document.getElementById('audName').value.trim();
  const phone=document.getElementById('audPhone').value.trim();
  if(!name||!phone){alert('Enter name and phone');return;}
  if(!audioBlob){alert('Record audio first');return;}

  const base64 = await blobToBase64(audioBlob);
  const payload = {
    character: currentChar.name,
    character_id: currentChar.id,
    name,
    phone,
    audio: { filename: `${name} - ${phone}.mp3`, mime: audioBlob.type, base64 },
    driveFolderId: '1tkPEJIhPOnOxzPDhXImeQG9vLuRFESib'
  };

  try{
    const res = await fetch(SCRIPT_URL, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    const data = await res.json();
    alert(data.message || 'Uploaded to Drive!');
  }catch(e){ console.error(e); alert('Upload failed ‚Äî check console and SCRIPT_URL.'); }
}

function blobToBase64(blob){
  return new Promise((resolve,reject)=>{
    const reader = new FileReader();
    reader.onloadend = ()=> resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}
</script>
</body>
</html>
